#!/bin/bash

ProgDir=$(cd $(dirname "${BASH_SOURCE[0]}"); pwd -P)

modpath=$1
controllerpath=$2
shift 2

modname=$(echo ${modpath} | rev | cut -d'/' -f1 | rev)
controllername=$(echo ${controllerpath} | rev | cut -d'/' -f1 | rev)

#workpath=$3

#max_job=$1
#shift
#max_time=$1
#shift

SHORTOPTS="j:t:" 
LONGOPTS="job-limit:,time-limit:"

ARGS=$(getopt -s bash --options $SHORTOPTS --longoptions $LONGOPTS -- "$@" ) 

eval set -- "$ARGS" 

job_limit=""
time_limit=""

while true
do
    case $1 in
        -j | --job-limit)
            job_limit=$2
            shift
            ;;
        -t | --time-limit)
            time_limit=$2
            shift
            ;;
        --)
            shift
            break
            ;;
        *)
            shift
            break
            ;;
    esac
    shift
done

if [ "$#" -eq 1 ]
then
    nodeshift=$1
    python ${ProgDir}/tools/create_tool.py "${controllerpath}" "analyze.py" "${controllerpath}/logs" "${controllerpath}/analyze" --job-limit "${job_limit}" --time-limit "${time_limit}" --out-files "analysis.pdf" --node-shift "${nodeshift}"
else
    python ${ProgDir}/tools/create_tool.py "${controllerpath}" "analyze.py" "${controllerpath}/logs" "${controllerpath}/analyze" --job-limit "${job_limit}" --time-limit "${time_limit}" --out-files "analysis.pdf"
fi