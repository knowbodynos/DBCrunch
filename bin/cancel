#!/bin/bash

case $# in
    0)
        jobs=$(squeue -h -u ${USER} -o '%.10i %.40j %.2t' 2>/dev/null | head -c -1 | tr '\n' '!')
        while [ "$(echo ${jobs} | tr '!' '\n' 2>/dev/null | grep -vE ' CG( |$)' | wc -l)" -ne 0 ]
        do
            for jobid in $(echo " ${jobs}" | tr '!' '\n' 2>/dev/null | grep -v "(null)" | sed 's/\s\s*/ /g' | cut -d' ' -f2)
            do
                scancel ${jobid} 2>/dev/null
            done
            jobs=$(squeue -h -u ${USER} -o '%.10i %.40j %.2t' 2>/dev/null | head -c -1 | tr '\n' '!')
        done
        ;;
    1)
        modname=$1
        jobs=$(squeue -h -u ${USER} -o '%.10i %.40j %.2t' 2>/dev/null | head -c -1 | tr '\n' '!')
        while [ "$(echo ${jobs} | tr '!' '\n' 2>/dev/null | grep -vE ' CG( |$)' | wc -l)" -ne 0 ]
        do
            for jobid in $(echo " ${jobs}" | tr '!' '\n' 2>/dev/null | grep -E "( |_)${modname}_" | sed 's/\s\s*/ /g' | cut -d' ' -f2)
            do
                scancel ${jobid} 2>/dev/null
            done
            jobs=$(squeue -h -u ${USER} -o '%.10i %.40j %.2t' 2>/dev/null | head -c -1 | tr '\n' '!')
        done
        ;;
    2)
        modname=$1
        controllername=$2
        jobs=$(squeue -h -u ${USER} -o '%.10i %.40j %.2t' 2>/dev/null | head -c -1 | tr '\n' '!')
        while [ "$(echo ${jobs} | tr '!' '\n' 2>/dev/null | grep -vE ' CG( |$)' | wc -l)" -ne 0 ]
        do
            for jobid in $(echo " ${jobs}" | tr '!' '\n' 2>/dev/null | grep -E "( |_)${modname}_${controllername}( |_|$)" | sed 's/\s\s*/ /g' | cut -d' ' -f2)
            do
                scancel ${jobid} 2>/dev/null
            done
            jobs=$(squeue -h -u ${USER} -o '%.10i %.40j %.2t' 2>/dev/null | head -c -1 | tr '\n' '!')
        done
        ;;
esac